<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link rel="shortcut icon" href="./favicon/favicon.ico" type="image/x-icon">
    <title>Un jueguito</title>
</head>
<body>
    <div id="loading-screen">
        <p>Cargando...</p>
        <div class="spinner"></div>
    </div>
    <div id="game-container">

        <button id="sleep">Dormir</button>
        <button id="retry">Tu oso ha muerto! <br> Inténtalo denuevo.</button>

        <div id="background"></div>
        <div id="background-overlay"></div>

        <div id="messages"></div>

        <div id="bear">
            <img class="bear-img" src="bear.png" alt="">
        </div>

        <div id="stats-container">
            <div class="stat-bar-wrapper">
                <span class="stat-label">Hambre:</span>
                <div id="hunger-bar" class="stat-bar">
                    <div class="stat-fill" style="background-color: orange;"></div>
                </div>
                <span id="hunger-value" class="stat-value">0%</span>
            </div>

            <div class="stat-bar-wrapper">
                <span class="stat-label">Salud:</span>
                <div id="health-bar" class="stat-bar">
                    <div class="stat-fill" style="background-color: limegreen;"></div>
                </div>
                <span id="health-value" class="stat-value">100%</span>
            </div>

            <div class="stat-bar-wrapper">
                <span class="stat-label">Diversión:</span>
                <div id="fun-bar" class="stat-bar">
                    <div class="stat-fill" style="background-color: dodgerblue;"></div>
                </div>
                <span id="fun-value" class="stat-value">100%</span>
            </div>

            <div id="money-display" class="stat-text">
                Dinero: $<span id="money-value">50</span>
            </div>
        </div>
        <a href="./manual.html" target="_blank">
            <div id="help">
                <i class="fa-solid fa-question"></i>
            </div>
        </a>
        
        <div id="speakers"><img id="speakersimg" src="./house_items/speakers.png" alt="speakers"></div>
            <div id="musicmenu">
                <button id="shakiraAntologiaBtn">Shakira - Antología</button>
                <button id="sherineKalamEinehBtn">Sherine - Kalam Eineh</button>
                <button id="someBoysBtn">Some boys take a beautiful girl and hide her away</button>
            </div>

        <div id="books"><img id="booksimg" src="./house_items/books.png" alt="books"></div>
        <div id="pages">
                <div id="page1">
                Extraño la luz de tus mañanas,
                el café compartido, la prisa de tus besos.
                Se ha ido el tiempo, se han ido las ganas
                de todo aquello que en ti hallaba mis regresos.
                Ahora el día se extiende gris, sin tu presencia,
                y mi alma, errante, busca la estela de tu ausencia.
            </div>
            <div id="page2">
                Y en tu recuerdo, la noche se hizo más larga,
                un eco suave de risas que el viento se lleva.
                Me queda el rastro de tu voz, una amarga
                dulzura que en el alma el tiempo no atreve a secar.
                Fuiste un sol que partió, dejando en mi ventana
                la sombra fiel de lo que un día fue, y no volverá.
            </div>
        </div>
        
        <div id="inventory"><img id="boximg" src="./house_items/box.png" alt="box"></div>
            <div id="inventorymenu">
                <button id="closeInventoryBtn">Cerrar</button>
                <h2>Inventario</h2>
                <div id="inventory-list"></div>
            </div>
        <div id="paint"><img id="paintimg" src="./house_items/trophy.png" alt="painting"></div>
        <div id="game-stats">
            <h1 id="stats-back">Atras</h1>
            <h1>Estadísticas</h1>
            <h1 id="stats-timeplayed"></h1>
            <h1>Más estadísticas pronto</h1>
        </div>

        <div id="shoes"><img id="shoesimg" src="./house_items/shoes.png" alt="shoes"></div>
        <div id="out-menu">
            <button id="walk">Salir a caminar</button>
            <button id="hospital">Ir al hospital (precio: 400)</button>
        </div>
        <div id="work"><img id="caseimg" src="./house_items/briefcase.png" alt="briefcase"></div>
        <div id="market"><img id="shoppingimg" src="./house_items/shopping.png" alt="shopping bag"></div>
            <div id="marketmenu">
                <button id="back">X</button>
                <h2>Mercado</h2>
                <h3 id="money-store">Dinero: </h3>
                <div id="market-items-list"></div>
            </div>
            
    </div>
    <div id="follower-div"></div>
    <script>

        const marketItemsData = {
            'fries': {
                name: 'Papas fritas',
                price: 20,
                hungerReplenish: 20,
                image: 'food_items/fries.png'
            },
            'hamburger': {
                name: 'Hamburguesa',
                price: 40,
                hungerReplenish: 35,
                image: 'food_items/burger.png'
            },
            'ground-meat': {
                name: 'Carne Molida',
                price: 30,
                hungerReplenish: 25,
                image: 'food_items/meat.png'
            },
            'salad': {
                name: 'Ensalada',
                price: 10,
                hungerReplenish: 10,
                image: 'food_items/salad.png'
            },
            'cake': {
                name: 'Pastel de caramelo',
                price: 70,
                hungerReplenish: 55,
                image: 'food_items/cake.png'
            },
            'ice-cream': {
                name: 'Helado de chocolate',
                price: 25,
                hungerReplenish: 22,
                image: 'food_items/icecream.png'
            },
            'taco': {
                name: 'Taco de carne molida',
                price: 50,
                hungerReplenish: 40,
                image: 'food_items/taco.png'
            }
        };


        const loadingScreen = document.getElementById('loading-screen');

        const imageUrls = [
            'bear.png',
            'house_items/shopping.png',
            'house_items/speakers.png',
            'house_items/box.png',
            'house_items/trophy.png',
            'house_items/shoes.png',
            'house_items/briefcase.png',
            'backgrounds/home.png',
            'backgrounds/home-night.png',
            'backgrounds/market.png',
            'backgrounds/black.jpg',
        ];

        for (const itemId in marketItemsData) {
            if (marketItemsData.hasOwnProperty(itemId) && marketItemsData[itemId].image) {
                imageUrls.push(marketItemsData[itemId].image);
            }
        }

        function preloadImages() {
            let loadedCount = 0;
            const totalImages = imageUrls.length;

            if (totalImages === 0) {
                loadingScreen.style.display = 'none';
                start();
                return;
            }

            imageUrls.forEach(url => {
                const img = new Image();
                img.onload = () => {
                    loadedCount++;
                    if (loadedCount === totalImages) {
                        loadingScreen.style.opacity = '0';
                        setTimeout(() => {
                            loadingScreen.style.display = 'none';
                            start(); // Start the game!
                        }, 500);
                    }
                };
                img.onerror = (e) => {
                    console.error(`Failed to load image: ${url}`, e);
                    loadedCount++;
                    if (loadedCount === totalImages) {
                        loadingScreen.style.opacity = '0';
                        setTimeout(() => {
                            loadingScreen.style.display = 'none';
                            start();
                        }, 500);
                    };
                };
                img.src = url;
            });
        };

        let gameInterval = null

        document.addEventListener('DOMContentLoaded', () => {
            const gameContainer = document.getElementById('game-container');
            const designWidth = 1920;
            const designHeight = 1080;

            function scaleGame() {
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;

                const scaleX = viewportWidth / designWidth;
                const scaleY = viewportHeight / designHeight;

                const scaleFactor = Math.min(scaleX, scaleY);

                gameContainer.style.transform = `scale(${scaleFactor})`;

                const scaledWidth = designWidth * scaleFactor;
                const scaledHeight = designHeight * scaleFactor;

                gameContainer.style.width = `${designWidth}px`;
                gameContainer.style.height = `${designHeight}px`;

                gameContainer.style.position = 'absolute';
                gameContainer.style.left = `${(viewportWidth - scaledWidth) / 2}px`;
                gameContainer.style.top = `${(viewportHeight - scaledHeight) / 2}px`;
            }

            scaleGame();

            window.addEventListener('resize', scaleGame);


            const followerDiv = document.getElementById('follower-div');

            document.addEventListener('mousemove', (e) => {
                followerDiv.style.left = `${e.clientX}px`;
                followerDiv.style.top = `${e.clientY - 30}px`;
            });

            document.addEventListener('mouseleave', () => {
                followerDiv.style.display = 'none';
            });

            document.addEventListener('mouseenter', () => {
                followerDiv.style.display = 'block';
            });

            const musicTracks = [
                { id: 'shakiraAntologia', name: 'Shakira - Antología', path: 'audio/shakira_antologia.mp3' },
                { id: 'sherineKalamEineh', name: 'Sherine - Kalam Eineh', path: 'audio/sherine_kalam_eineh.mp3' },
                { id: 'someBoys', name: 'Some boys take a beautiful girl and hide her away', path: 'audio/some_boys.mp3' },
            ];

            const audioPlayers = {};
            let currentPlayingTrackId = null;


            musicTracks.forEach(track => {
                audioPlayers[track.id] = new Audio(track.path);
                audioPlayers[track.id].loop = true;
                audioPlayers[track.id].volume = 1;
                
            });

            const shakiraAntologiaBtn = document.getElementById('shakiraAntologiaBtn');
            const sherineKalamEinehBtn = document.getElementById('sherineKalamEinehBtn');
            const someBoysBtn = document.getElementById('someBoysBtn');

            function toggleTrack(trackId) {
                const audio = audioPlayers[trackId];

                if (!audio) {
                    return;
                }

                if (audio.paused) {
                    if (currentPlayingTrackId && currentPlayingTrackId !== trackId) {
                        const prevAudio = audioPlayers[currentPlayingTrackId];
                        if (prevAudio) {
                            prevAudio.pause();
                            prevAudio.currentTime = 0;
                        }
                    }

                    audio.play()
                        .then(() => {
                            currentPlayingTrackId = trackId;
                        })
                        .catch(error => {
                            console.warn(`Failed to play ${musicTracks.find(t => t.id === trackId).name}:`, error);
                        });
                } else {
                    audio.pause();
                    audio.currentTime = 0;
                    currentPlayingTrackId = null;
                }
            }

            shakiraAntologiaBtn.addEventListener('click', () => toggleTrack('shakiraAntologia'));
            sherineKalamEinehBtn.addEventListener('click', () => toggleTrack('sherineKalamEineh'));
            someBoysBtn.addEventListener('click', () => toggleTrack('someBoys'));

            preloadImages();
        });

        const backgroundDiv = document.getElementById('background');
        const backgroundOverlayDiv = document.getElementById('background-overlay'); 

        function changeBackground(newImageUrl, transitionDuration = 1500) {
            backgroundOverlayDiv.style.backgroundImage = `url(${newImageUrl})`;

            requestAnimationFrame(() => {
                backgroundOverlayDiv.style.opacity = '1';
            });

            setTimeout(() => {
                backgroundDiv.style.backgroundImage = `url(${newImageUrl})`;
                backgroundOverlayDiv.style.opacity = '0';
            }, transitionDuration);
        }

        function changeBackgroundBlack(newImageUrl) {
            backgroundOverlayDiv.style.backgroundImage = `url('./backgrounds/black.jpg')`;
            backgroundOverlayDiv.style.zIndex = 1;
            backgroundOverlayDiv.style.opacity = '1';

            requestAnimationFrame(() => {
                backgroundOverlayDiv.style.opacity = '1';
            });

            setTimeout(() => {
                backgroundDiv.style.backgroundImage = `url(${newImageUrl})`;
                setTimeout(() => {
                    backgroundOverlayDiv.style.opacity = '0';
                    setTimeout(() => {
                        backgroundOverlayDiv.style.zIndex = -1;
                    }, 1000);
                }, 1000);
            }, 1000);

        }


        const hungerFill = document.querySelector('#hunger-bar .stat-fill');
        const healthFill = document.querySelector('#health-bar .stat-fill');
        const funFill = document.querySelector('#fun-bar .stat-fill');

        const hungerValueDisplay = document.getElementById('hunger-value');
        const healthValueDisplay = document.getElementById('health-value');
        const funValueDisplay = document.getElementById('fun-value');
        const moneyValueDisplay = document.getElementById('money-value');

        const marketMenu = document.getElementById('marketmenu');
        const marketItemsListDiv = document.getElementById('market-items-list');


        const inventoryMenu = document.getElementById('inventorymenu');
        const inventoryListDiv = document.getElementById('inventory-list');
        const closeInventoryBtn = document.getElementById('closeInventoryBtn');

        function displayInventory() {
            inventoryListDiv.innerHTML = '';

            if (Object.keys(inventory).length === 0 || Object.values(inventory).every(qty => qty === 0)) {
                inventoryListDiv.innerHTML = '<p style="text-align: center; font-style: italic; opacity: 0.8;">Tu inventario está vacío.</p>';
            }

            for (const itemId in inventory) {
                if (inventory.hasOwnProperty(itemId)) {
                    const quantity = inventory[itemId];
                    const itemDetails = marketItemsData[itemId];

                    if (itemDetails && quantity > 0) {
                        const itemDiv = document.createElement('div');
                        itemDiv.classList.add('inventory-item');

                        const itemImage = document.createElement('img');
                        itemImage.src = itemDetails.image;
                        itemImage.alt = itemDetails.name;
                        itemImage.classList.add('inventory-item-img');
                        itemDiv.appendChild(itemImage);

                        const itemNameSpan = document.createElement('span');
                        itemNameSpan.classList.add('item-name');
                        itemNameSpan.textContent = itemDetails.name;
                        itemDiv.appendChild(itemNameSpan);

                        const itemQuantitySpan = document.createElement('span');
                        itemQuantitySpan.classList.add('item-quantity');
                        itemQuantitySpan.textContent = `x${quantity}`;
                        itemDiv.appendChild(itemQuantitySpan);

                        const useButton = document.createElement('button');
                        useButton.textContent = 'Usar';
                        useButton.classList.add('use-item-btn');
                        useButton.addEventListener('click', () => useItem(itemId));

                        itemDiv.appendChild(useButton);

                        inventoryListDiv.appendChild(itemDiv);
                    }
                }
            }
            inventoryMenu.style.display = 'flex';
        }

        function useItem(itemId) {
            const itemData = marketItemsData[itemId];

            if (!itemData) {
                console.warn(`No data found for item with ID: ${itemId}`);
                return;
            }

            if (inventory[itemId] > 0) {
                inventory[itemId]--;

                if (itemData.hungerReplenish) {
                    hunger -= itemData.hungerReplenish;
                }
                if (itemData.healthReplenish) {
                    health += itemData.healthReplenish;
                }
                if (itemData.funReplenish) {
                    fun += itemData.funReplenish;
                }

                hunger = Math.max(0, Math.min(100, hunger));
                health = Math.max(0, Math.min(100, health));
                fun = Math.max(0, Math.min(100, fun));

                localStorage.setItem('inventory', JSON.stringify(inventory));
                localStorage.setItem('hunger', hunger.toString());
                localStorage.setItem('health', health.toString());
                localStorage.setItem('fun', fun.toString());

                cursorMessage.textContent = "Has consumido '" + itemData.name + "'.";
                cursorMessage.classList.add('toggled-on');
                setTimeout(() => {
                    cursorMessage.classList.remove('toggled-on');
                }, 1000);

                updateStatsDisplay();
                displayInventory();
            }
        }

        function updateStatsDisplay() {
            hunger = Math.max(0, Math.min(100, hunger));
            health = Math.max(0, Math.min(100, health));
            fun = Math.max(0, Math.min(100, fun));
            money = Math.max(0, money);

            hungerFill.style.width = `${hunger}%`;
            healthFill.style.width = `${health}%`;
            funFill.style.width = `${fun}%`;

            hungerValueDisplay.textContent = `${Math.round(hunger)}%`;
            healthValueDisplay.textContent = `${Math.round(health)}%`;
            funValueDisplay.textContent = `${Math.round(fun)}%`;
            moneyValueDisplay.textContent = `${Math.round(money)}`;

            if (health < 20) {
                document.getElementById('health-bar').classList.add('low');
            } else {
                document.getElementById('health-bar').classList.remove('low');
            }

            if (hunger > 80) {
                document.getElementById('hunger-bar').classList.add('high');
            } else {
                document.getElementById('hunger-bar').classList.remove('high');
            }

            localStorage.setItem('hunger', hunger.toString());
            localStorage.setItem('health', health.toString());
            localStorage.setItem('fun', fun.toString());
            localStorage.setItem('money', money.toString());
        }

        let hunger;
        let health;
        let fun;
        let money;
        let inventory;
        let time;
        let timeplayed;
        let currentPlace;
        const cursorMessage = document.getElementById('follower-div');

        let utilities = [
            {
                id: 1,
                name: "medkit"
            }
        ]

        let places = [
            {
                id: 1,
                name: "Casa",
                img: "url(backgrounds/home.png)"
            },
            {
                id: 2,
                name: "Supermercado",
                img: "url(backgrounds/market.png)"
            },
            {
                id: 3,
                name: "Parque",
                img: ""
            },
            {
                id: 4,
                name: "Parque de diversiones",
                img: ""
            },
        ]

        let activities = [
            {
                id: 1,
                name: "Salir a caminar",
                price: "0",
                replenish: 40,
            },
            {
                id: 2,
                name: "Leer un libro",
                price: "10",
                replenish: 50,
            },
            {
                id: 3,
                name: "Pintar",
                price: "15",
                replenish: 60,
            },
            {
                id: 4,
                name: "Escuchar Musica",
                price: "15",
                replenish: 60,
            },
            {
                id: 5,
                name: "Parque de diversiones",
                price: "70",
                replenish: 100,
            },
        ]

        function populateMarket() {
            marketItemsListDiv.innerHTML = '';

            for (const itemId in marketItemsData) {
                if (marketItemsData.hasOwnProperty(itemId)) {
                    const itemData = marketItemsData[itemId];

                    const itemDiv = document.createElement('div');
                    itemDiv.id = itemId;
                    itemDiv.classList.add('market-item');

                    const itemImage = document.createElement('img');
                    itemImage.src = itemData.image;
                    itemImage.alt = itemData.name;
                    itemImage.classList.add('market-item-img');
                    itemDiv.appendChild(itemImage);

                    const itemName = document.createElement('h3');
                    itemName.textContent = itemData.name;
                    itemDiv.appendChild(itemName);

                    const itemPrice = document.createElement('p');
                    itemPrice.textContent = `Precio: $${itemData.price}`;
                    itemPrice.classList.add('item-price');
                    itemDiv.appendChild(itemPrice);

                    itemDiv.addEventListener('click', () => {
                        buyItem(itemId);
                    });

                    marketItemsListDiv.appendChild(itemDiv);
                }
            }
        }

        function buyItem(itemId) {
            const itemData = marketItemsData[itemId];

            if (itemData) {
                if (money >= itemData.price) {

                    cursorMessage.textContent = "Has comprado '" + itemData.name + "'.";
                    cursorMessage.classList.add('toggled-on');
                    setTimeout(() => {
                        cursorMessage.classList.remove('toggled-on');
                    }, 1000);

                    money -= itemData.price;
                    if (inventory[itemId]) {
                        inventory[itemId]++;
                    } else {
                        inventory[itemId] = 1;
                    }

                    document.getElementById('money-store').innerHTML = "Dinero: $" + money.toString();

                    localStorage.setItem('inventory', JSON.stringify(inventory));
                    localStorage.setItem('money', money);
                    updateStatsDisplay();
                } else {
                    cursorMessage.textContent = 'No tienes suficiente dinero!';
                    cursorMessage.classList.add('toggled-on');
                    setTimeout(() => {
                        cursorMessage.classList.remove('toggled-on');
                    }, 1000);
                }
            } else {
                console.warn(`No data found for market item with ID: ${itemId}`);
            }
        }

        window.onload = function() {
            hideItems();
            document.getElementById('bear').style.display='none';
            document.getElementById('marketmenu').style.display = 'none';
            document.getElementById('inventorymenu').style.display = 'none';

        };

        function start() {
            hideItems();
            document.getElementById('marketmenu').style.display = 'none';
            document.getElementById('inventorymenu').style.display = 'none';

            const message = document.getElementById("messages");
            message.style.display = "block";
            message.innerHTML = "<h1> Holiiiiii </h1>";
            setTimeout(() => {
                message.innerHTML = "<h1> Te dedico este jueguito. Espero que te guste ;D </h1>";
                setTimeout(() => {
                    message.innerHTML = "";
                    message.style.display = "none";
                    setTimeout(() => {
                        showItems();
                        document.getElementById('bear').style.display = "block";
                    }, 1500);
                    
                    if (gameInterval !== null) {
                        clearInterval(gameInterval);
                        console.log("Cleared existing gameInterval before new start. Old ID:", gameInterval);
                    }

                    populateMarket();

                    if(!localStorage.getItem('money')){
                        money = 50;
                    } else {
                        money = localStorage.getItem('money');
                    }

                    hunger = localStorage.getItem('hunger') || 0;
                    health = localStorage.getItem('health') || 100;
                    fun = localStorage.getItem('fun') || 100;
                    time = localStorage.getItem('time') || 0;
                    timeplayed = parseInt(localStorage.getItem('timeplayed')) || 0;
                    inventory = JSON.parse(localStorage.getItem('inventory')) || {};
                    currentPlace = 'home';
                    updateStatsDisplay(); 

                    if (time >= 20) {
                        changeBackgroundBlack('./backgrounds/home-night.png');
                        document.getElementById('sleep').classList.add('toggled-on');   
                    } else {
                        changeBackgroundBlack('./backgrounds/home.png');
                    }

                    gameInterval = setInterval(() => {
                        
                        if (hunger >= 100) {
                            health -= 3;
                            hunger = 100
                        } else {
                            hunger += 0.5;
                        };

                        if (fun <= 0 && hunger != 100) {
                            hunger += 1;
                        } else if (fun <= 0){
                            fun = 0
                        } else {
                            fun -= 1;
                        }

                        time ++
                        timeplayed += 10

                        localStorage.setItem('money', money);
                        localStorage.setItem('hunger', hunger);
                        localStorage.setItem('fun', fun);
                        localStorage.setItem('health', health);
                        localStorage.setItem('time', time);
                        localStorage.setItem('timeplayed', timeplayed);


                        if (time == 21 && currentPlace == 'home') {
                            document.getElementById('sleep').classList.add('toggled-on');
                        }


                        if (time == 20 && currentPlace == 'home') {
                            changeBackground('./backgrounds/home-night.png');
                        }

                        updateStatsDisplay();


                        if (health <= 0) {
                            clearInterval(gameInterval);
                            gameInterval = null;
                            localStorage.removeItem('money');
                            localStorage.removeItem('inventory');
                            localStorage.removeItem('hunger');
                            localStorage.removeItem('fun');
                            localStorage.removeItem('health');
                            localStorage.removeItem('time');
                            hideItems();
                            document.getElementById('bear').style.display = 'none'
                            document.getElementById('retry').classList.add('toggled-on');
                        }
                    }, 10000);
                }, 3500);
            }, 2000);
        }


        document.getElementById('retry').addEventListener("click", function(){
            changeBackgroundBlack('./backgrounds/home.png');
            document.getElementById('retry').classList.remove('toggled-on');
            setTimeout(() => {
                localStorage.removeItem('money');
                localStorage.removeItem('inventory');
                localStorage.removeItem('hunger');
                localStorage.removeItem('fun');
                localStorage.removeItem('health');
                localStorage.removeItem('time');
                start();
            }, 1500);
        });

        document.getElementById('market').addEventListener("click", function(){
            if (time >= 20) {
                cursorMessage.textContent = 'La tienda está cerrada.';
                cursorMessage.classList.add('toggled-on')
                setTimeout(() => {
                    cursorMessage.classList.remove('toggled-on')
                }, 2000);
            } else {
                currentPlace = 'market';
                changeBackgroundBlack('./backgrounds/market.png');
                document.getElementById('money-store').innerHTML = "Dinero: $" + money.toString();
                setTimeout(() => {
                    hideItems()
                    document.getElementById('marketmenu').style.display = 'flex'
                }, 1500);
            }
        });

        document.getElementById('market').addEventListener("mouseover", function(){
            cursorMessage.textContent = 'Ir a la tienda.';
            cursorMessage.classList.add('toggled-on')
            setTimeout(() => {
                cursorMessage.classList.remove('toggled-on')
            }, 1500);
        });

        document.getElementById('work').addEventListener("mouseover", function(){
            cursorMessage.textContent = 'Ir a trabajar.';
            cursorMessage.classList.add('toggled-on')
            setTimeout(() => {
                cursorMessage.classList.remove('toggled-on')
            }, 1500);
        });

        document.getElementById('books').addEventListener("mouseover", function(){
            cursorMessage.textContent = 'Leer libros (precio: 10).';
            cursorMessage.classList.add('toggled-on')
            setTimeout(() => {
                cursorMessage.classList.remove('toggled-on')
            }, 2000);
        });

        document.getElementById('inventory').addEventListener("mouseover", function(){
            cursorMessage.textContent = 'Abrir inventario.';
            cursorMessage.classList.add('toggled-on')
            setTimeout(() => {
                cursorMessage.classList.remove('toggled-on')
            }, 1500);
        });

        document.getElementById('speakers').addEventListener("mouseover", function(){
            cursorMessage.textContent = 'Escuchar música.';
            cursorMessage.classList.add('toggled-on')
            setTimeout(() => {
                cursorMessage.classList.remove('toggled-on');
            }, 1500);
        });

        document.getElementById('shoes').addEventListener("mouseover", function(){
            cursorMessage.textContent = 'Salir.';
            cursorMessage.classList.add('toggled-on');
            setTimeout(() => {
                cursorMessage.classList.remove('toggled-on');
            }, 1500);
        });

        document.getElementById('paint').addEventListener("mouseover", function(){
            cursorMessage.textContent = 'Ver estadísticas.';
            cursorMessage.classList.add('toggled-on');
            setTimeout(() => {
                cursorMessage.classList.remove('toggled-on');
            }, 1500);
        });

        document.getElementById('inventory').addEventListener("click", function(){
            displayInventory();
            hideItems();
        });

        closeInventoryBtn.addEventListener('click', () => {
            inventoryMenu.style.display = 'none';
            showItems();
        });

        document.getElementById('speakers').addEventListener("click", function(){
            document.getElementById('musicmenu').classList.toggle('toggled-on');
        });

        document.getElementById('books').addEventListener('click', () => {
            if (money < 10) {
                cursorMessage.textContent = 'No tienes suficiente dinero para comprar un libro.';
                cursorMessage.classList.add('toggled-on');
                setTimeout(() => {
                    cursorMessage.classList.remove('toggled-on');
                }, 2000);
            } else {
                currentPlace = 'reading';
                changeBackgroundBlack('./backgrounds/book.png');

                setTimeout(() => {
                    hideItems();
                    document.getElementById('bear').style.display = 'none';
                    document.getElementById('pages').style.display = 'flex';
                }, 1500);

                setTimeout(() => {
                    money -= 10
                    fun += 50
                    localStorage.setItem('money', money);
                    localStorage.setItem('fun', fun);
                    currentPlace = 'home';
                    if (time >= 20) {
                        changeBackgroundBlack('./backgrounds/home-night.png');
                    } else {
                        changeBackgroundBlack('./backgrounds/home.png');    
                    }
                    setTimeout(() => {
                        showItems();
                        document.getElementById('bear').style.display = '';
                        document.getElementById('pages').style.display = 'none';
                        if (time >= 20) {
                            document.getElementById('sleep').classList.add('toggled-on');
                        }
                    }, 1500);
                }, 15000);
            }
        });


        document.getElementById('sleep').addEventListener("click", function(){
            time = 0;
            changeBackgroundBlack('./backgrounds/home.png');
            document.getElementById('sleep').classList.remove('toggled-on');
        });

        document.getElementById('shoes').addEventListener("click", function(){
            document.getElementById('out-menu').classList.toggle('toggled-on');
        });

        document.getElementById('paint').addEventListener("click", function(){
            document.getElementById('stats-timeplayed').textContent = "Tiempo jugado: " + formatSecondsToHMS(timeplayed);
            document.getElementById('game-stats').classList.add('toggled-on');
            hideItems();
        });

        document.getElementById('stats-back').addEventListener("click", function(){
            document.getElementById('game-stats').classList.remove('toggled-on');
            showItems();
        });

        document.getElementById('back').addEventListener("click", function(){
            if (time >= 20) {
                changeBackgroundBlack('./backgrounds/home-night.png');
            } else {
                changeBackgroundBlack('./backgrounds/home.png');    
            }
            currentPlace = 'home';
            setTimeout(() => {
                showItems();
                document.getElementById('marketmenu').style.display = 'none'
                if (time >= 20) {
                    document.getElementById('sleep').classList.add('toggled-on')
                }
            }, 1500);
        });

        document.getElementById('walk').addEventListener("click", function(){
            if (time >= 20) {
                cursorMessage.textContent = 'Es muy tarde para salir.';
                cursorMessage.classList.add('toggled-on');
                setTimeout(() => {
                    cursorMessage.classList.remove('toggled-on');
                }, 3000);
            } else {
                document.getElementById('out-menu').classList.remove('toggled-on');
                currentPlace = 'outside';
                changeBackgroundBlack('./backgrounds/outside.png');

                setTimeout(() => {
                    hideItems();
                    document.getElementById('bear').classList.add('park');
                }, 1500);

                setTimeout(() => {
                    fun += activities[0].replenish;
                    currentPlace = 'home';
                    if (time >= 20) {
                        changeBackgroundBlack('./backgrounds/home-night.png');
                    } else {
                        changeBackgroundBlack('./backgrounds/home.png');
                    }

                    setTimeout(() => {
                        showItems();
                        document.getElementById('bear').classList.remove('park');
                        updateStatsDisplay();
                        if (time >= 20) {
                            document.getElementById('sleep').classList.add('toggled-on');
                        }
                    }, 1500);
                }, 9000);
            }
        });

        document.getElementById('work').addEventListener("click", function(){
            if (time >= 20) {
                cursorMessage.textContent = 'Es muy tarde para trabajar.';
                cursorMessage.classList.add('toggled-on');
                setTimeout(() => {
                    cursorMessage.classList.remove('toggled-on');
                }, 3000);
            } else {
                currentPlace = 'work';
                changeBackgroundBlack('./backgrounds/work.png');

                setTimeout(() => {
                    hideItems();
                    document.getElementById('bear').classList.add('work');
                    document.getElementsByClassName('bear-img')[0].classList.add('work');
                }, 1500);

                setTimeout(() => {
                    money += 100
                    localStorage.setItem('money', money);
                    currentPlace = 'home';
                    if (time >= 20) {
                        changeBackgroundBlack('./backgrounds/home-night.png');
                    } else {
                        changeBackgroundBlack('./backgrounds/home.png');    
                    }
                    setTimeout(() => {
                        showItems();
                        document.getElementById('bear').classList.remove('work');
                        document.getElementsByClassName('bear-img')[0].classList.remove('work');
                        updateStatsDisplay();
                        if (time >= 20) {
                            document.getElementById('sleep').classList.add('toggled-on');
                        }
                    }, 1500);
                }, 20000);
            }
        });

        document.getElementById('hospital').addEventListener("click", function(){
            if (money < 400) {
                cursorMessage.textContent = 'No tienes suficiente dinero.';
                cursorMessage.classList.add('toggled-on');
                setTimeout(() => {
                    cursorMessage.classList.remove('toggled-on');
                }, 2000);
            } else {
                document.getElementById('out-menu').classList.remove('toggled-on');
                currentPlace = 'hospital';
                changeBackgroundBlack('./backgrounds/hospital.png');

                setTimeout(() => {
                    hideItems();
                    document.getElementById('bear').classList.add('hospital');
                }, 1500);

                setTimeout(() => {
                    money -= 400
                    health = 100
                    localStorage.setItem('money', money);
                    localStorage.setItem('health', health);
                    currentPlace = 'home';
                    if (time >= 20) {
                        changeBackgroundBlack('./backgrounds/home-night.png');
                    } else {
                        changeBackgroundBlack('./backgrounds/home.png');    
                    }
                    setTimeout(() => {
                        showItems();
                        document.getElementById('bear').classList.remove('hospital');
                        if (time >= 20) {
                            document.getElementById('sleep').classList.add('toggled-on');
                        }
                    }, 1500);
                }, 10000);
            }
        });


        function hideItems(){
            document.getElementById('books').style.display = 'none';
            document.getElementById('speakers').style.display = 'none';
            document.getElementById('musicmenu').style.display = 'none';
            document.getElementById('shoes').style.display = 'none';
            document.getElementById('out-menu').style.display = 'none';
            document.getElementById('sleep').style.display = 'none';
            document.getElementById('work').style.display = 'none';
            document.getElementById('market').style.display = 'none';
            document.getElementById('paint').style.display = 'none';
            document.getElementById('inventory').style.display = 'none';
        }

        function showItems(){
            document.getElementById('books').style.display = '';
            document.getElementById('speakers').style.display = '';
            document.getElementById('musicmenu').style.display = '';
            document.getElementById('shoes').style.display = '';
            document.getElementById('out-menu').style.display = '';
            document.getElementById('sleep').style.display = '';
            document.getElementById('work').style.display = '';
            document.getElementById('market').style.display = '';
            document.getElementById('paint').style.display = '';
            document.getElementById('inventory').style.display = '';
        }

        function formatSecondsToHMS(totalSeconds) {
            totalSeconds = Math.max(0, Math.floor(totalSeconds));

            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            const formattedMinutes = String(minutes).padStart(2, '0');
            const formattedSeconds = String(seconds).padStart(2, '0');

            return `${hours}h ${formattedMinutes}m ${formattedSeconds}s`;
        }



    </script>
</body>
</html>